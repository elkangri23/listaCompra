# üöÄ Colecci√≥n Postman/Thunder Client - Lista de Compra API

Esta carpeta contiene colecciones completas para probar todos los endpoints de la API de Lista de Compra Colaborativa.

## üìÅ Archivos Incluidos

- **`postman_collection.json`** - Colecci√≥n completa con todos los endpoints
- **`postman_environment.json`** - Variables de entorno para desarrollo local
- **`API_Testing_Guide.md`** - Esta gu√≠a de uso

## üõ†Ô∏è Herramientas Compatibles

### ‚úÖ Postman
1. Abre Postman
2. Clic en **Import** ‚Üí **Upload Files**
3. Selecciona `postman_collection.json`
4. Importa tambi√©n `postman_environment.json`
5. Selecciona el entorno "Lista Compra - Local Development"

### ‚úÖ Thunder Client (VS Code)
1. Instala la extensi√≥n Thunder Client en VS Code
2. Abre Thunder Client
3. Clic en **Collections** ‚Üí **Import** 
4. Selecciona `postman_collection.json`
5. Las variables se configuran autom√°ticamente

### ‚úÖ Insomnia
1. Abre Insomnia
2. Clic en **Application** ‚Üí **Import**
3. Selecciona `postman_collection.json`
4. Configura manualmente las variables de entorno

## üöÄ Gu√≠a de Uso R√°pido

### 1. **Iniciar el Servidor**
```bash
cd listaCompra
npm run dev
# Servidor corriendo en http://localhost:3000
```

### 2. **Flujo de Testing Recomendado**

#### Paso 1: Autenticaci√≥n
```
01. Autenticaci√≥n ‚Üí Registrar Usuario
01. Autenticaci√≥n ‚Üí Login (guarda token autom√°ticamente)
```

#### Paso 2: Configurar Tienda y Categor√≠as
```
05. Tiendas ‚Üí Crear Tienda (guarda storeId)
04. Categor√≠as ‚Üí Crear Categor√≠a (guarda categoryId)
```

#### Paso 3: Gesti√≥n de Listas
```
02. Listas de Compra ‚Üí Crear Lista (guarda listId)
02. Listas de Compra ‚Üí Obtener Mis Listas
```

#### Paso 4: Agregar Productos
```
03. Productos ‚Üí Agregar Producto a Lista (guarda productId)
03. Productos ‚Üí Obtener Productos de Lista
03. Productos ‚Üí Marcar Producto como Comprado
```

#### Paso 5: Compartir Lista
```
06. Invitaciones ‚Üí Compartir Lista (guarda invitationHash)
06. Invitaciones ‚Üí Acceder a Lista Compartida
```

### 3. **Variables Autom√°ticas**

Las siguientes variables se guardan autom√°ticamente al ejecutar ciertos endpoints:

| Variable | Se guarda en | Descripci√≥n |
|----------|--------------|-------------|
| `token` | Login exitoso | Token de autenticaci√≥n JWT |
| `userId` | Login exitoso | ID del usuario autenticado |
| `listId` | Crear Lista | ID de la lista creada |
| `productId` | Agregar Producto | ID del producto creado |
| `categoryId` | Crear Categor√≠a | ID de la categor√≠a creada |
| `storeId` | Crear Tienda | ID de la tienda creada |
| `invitationHash` | Compartir Lista | Hash de la invitaci√≥n |

## üìö Endpoints Disponibles

### üîê Autenticaci√≥n (5 endpoints)
- ‚úÖ Registrar Usuario
- ‚úÖ Login (guarda token autom√°ticamente)
- ‚úÖ Obtener Perfil Usuario
- ‚è≥ Refresh Token (pendiente implementar)
- ‚úÖ Logout

### üìù Listas de Compra (5 endpoints)
- ‚úÖ Crear Lista
- ‚úÖ Obtener Mis Listas (con paginaci√≥n)
- ‚úÖ Obtener Lista por ID
- ‚úÖ Actualizar Lista
- ‚úÖ Eliminar Lista

### üõí Productos (5 endpoints)
- ‚úÖ Agregar Producto a Lista
- ‚úÖ Obtener Productos de Lista (con filtros)
- ‚úÖ Marcar/Desmarcar como Comprado
- ‚úÖ Actualizar Producto
- ‚úÖ Eliminar Producto

### üè∑Ô∏è Categor√≠as (4 endpoints)
- ‚úÖ Crear Categor√≠a Personalizada
- ‚úÖ Obtener Categor√≠as por Tienda
- ‚úÖ Actualizar Categor√≠a
- ‚úÖ Eliminar Categor√≠a

### üè™ Tiendas (5 endpoints)
- ‚úÖ Crear Tienda
- ‚úÖ Obtener Todas las Tiendas (con filtros)
- ‚úÖ Obtener Tienda por ID
- ‚úÖ Actualizar Tienda
- ‚úÖ Eliminar Tienda

### üì§ Invitaciones (5 endpoints)
- ‚úÖ Compartir Lista (genera enlace)
- ‚úÖ Acceder a Lista Compartida (sin auth)
- ‚úÖ Obtener Invitaciones de Lista
- ‚úÖ Actualizar Permisos
- ‚úÖ Cancelar Invitaci√≥n

### ü§ñ Inteligencia Artificial (7 endpoints)
- ‚úÖ Sugerencias de Categor√≠as (`POST /ai/category-suggestions`)
- ‚úÖ Health Check IA (`GET /ai/health`)
- ‚úÖ Informaci√≥n de Uso (`GET /ai/usage` - Solo Admin)
- ‚úÖ **CU-29:** Categorizaci√≥n Masiva (`POST /ai/bulk-categorize`) - üÜï **30 Oct 2025**
- ‚úÖ **CU-32:** Obtener Ocasiones Disponibles (`GET /occasion-lists/occasions`)
- ‚úÖ **CU-32:** Generar Lista por Ocasi√≥n (`POST /occasion-lists/generate`)
- ‚úÖ **CU-32:** Preview Lista por Ocasi√≥n (`POST /occasion-lists/preview`)

### üìã Blueprints/Plantillas (6 endpoints)
- ‚úÖ Crear Blueprint (`POST /blueprints`)
- ‚úÖ Obtener Mis Blueprints (`GET /blueprints/my`)
- ‚úÖ Obtener Blueprints P√∫blicos (`GET /blueprints/public`)
- ‚úÖ Obtener Blueprint por ID (`GET /blueprints/:id`)
- ‚úÖ Crear Lista desde Blueprint (`POST /blueprints/:id/create-list`)
- ‚úÖ Actualizar/Eliminar Blueprint (`PUT/DELETE /blueprints/:id`)

### üëë Administraci√≥n (4 endpoints)
- ‚úÖ Impersonar Usuario (`POST /admin/impersonate/:targetUserId`)
- ‚úÖ Finalizar Impersonaci√≥n (`POST /admin/end-impersonation`)
- ‚úÖ Auditor√≠a de Impersonaciones (`GET /admin/audit/impersonations`)
- ‚úÖ Health Check Admin (`GET /admin/health`)

### üìä Dashboard y Monitoreo (4 endpoints)
- ‚úÖ M√©tricas del Sistema (`GET /dashboard/metrics`)
- ‚úÖ Health Check Sistema (`GET /dashboard/health`)
- ‚úÖ Alertas del Sistema (`GET /dashboard/alerts`)
- ‚úÖ An√°lisis de Performance (`GET /dashboard/performance`)

### üîí Seguridad y Cache (5 endpoints) - **NUEVOS**
- ‚úÖ Estado de Integridad (`GET /admin/cache/integrity/status`)
- ‚úÖ Escanear Corrupci√≥n (`POST /admin/cache/integrity/scan`)
- ‚úÖ Limpiar Cache Corrupto (`POST /admin/cache/integrity/cleanup`)
- ‚úÖ Reparar Cache (`POST /admin/cache/integrity/repair`)
- ‚úÖ M√©tricas de Integridad (`GET /admin/cache/integrity/metrics`)

### ü§ñ Recomendaciones con IA (3 endpoints) - **CU-33 NUEVOS (30 Oct 2025)**
- ‚úÖ Recomendaciones Generales (`GET /recommendations/:listId`)
- ‚úÖ Recomendaciones Espec√≠ficas (`GET /recommendations/:listId/for-product/:productId`)
- ‚úÖ Ejemplos de Contexto (`GET /recommendations/context-examples`) - P√∫blico

**Total de Endpoints:** **47+ endpoints** (6 de IA: CU-28, CU-32, CU-33)

### üìä Dashboard de Monitoreo (4 endpoints)
- ‚úÖ M√©tricas del Sistema (`GET /dashboard/metrics`)
- ‚úÖ Estado de Salud (`GET /dashboard/health`)
- ‚úÖ Alertas Activas (`GET /dashboard/alerts`)
- ‚úÖ Performance Detallado (`GET /dashboard/performance`)

### üîß Desarrollo (3 endpoints)
- ‚úÖ Info Sistema de Eventos
- ‚úÖ Reset Sistema de Eventos
- ‚úÖ Publicar Evento de Prueba

## üéØ Ejemplos de Testing

### Crear un Flujo Completo
1. **Registro**: `POST /auth/register`
2. **Login**: `POST /auth/login` ‚Üí Guarda token
3. **Crear Tienda**: `POST /stores` ‚Üí Guarda storeId
4. **Crear Categor√≠a**: `POST /categories` ‚Üí Guarda categoryId
5. **Crear Lista**: `POST /lists` ‚Üí Guarda listId
6. **Agregar Producto**: `POST /lists/{listId}/products`
7. **Compartir Lista**: `POST /invitations/{listId}/share`
8. **Acceder como Invitado**: `GET /invitations/access/{hash}`

### Probar Filtros
```
GET /lists/{listId}/products?comprado=false&urgente=true&busqueda=manzana
GET /stores?tipo=supermercado&activas=true&search=mercadona
GET /categories?tiendaId={storeId}&activas=true
```

### Probar Permisos
1. Crea lista con Usuario A
2. Comparte con Usuario B (solo lectura)
3. Intenta modificar con Usuario B ‚Üí Debe fallar
4. Cambia permisos a lectura-escritura
5. Intenta modificar con Usuario B ‚Üí Debe funcionar

### üîí **Testing de Seguridad y Cache** (NUEVO)

#### **Prerequisitos**
- Token de administrador activo
- Servidor corriendo en modo desarrollo

#### **Flujo de Testing:**
```
1. Autenticaci√≥n ‚Üí Login como Admin
2. Cache Integrity ‚Üí Estado de Integridad
3. Cache Integrity ‚Üí Escanear Corrupci√≥n 
4. Cache Integrity ‚Üí Ver M√©tricas de Integridad
5. Cache Integrity ‚Üí Limpiar Cache (si hay corrupci√≥n)
6. Cache Integrity ‚Üí Reparar Cache (opcional)
```

#### **Verificaciones de Seguridad:**
- ‚úÖ **Solo administradores** pueden acceder a endpoints de cache
- ‚úÖ **Rate limiting** aplicado (10 requests/15min para admin)
- ‚úÖ **Auditor√≠a de acciones** todas las operaciones loggeadas
- ‚úÖ **Validaci√≥n de datos** checksums MD5, SHA256, SHA512
- ‚úÖ **Sanitizaci√≥n de inputs** protecci√≥n XSS/injection autom√°tica

#### **Respuestas Esperadas:**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "totalChecked": 150,
    "corruptedFound": 0,
    "integrityScore": 100,
    "lastScan": "2025-10-29T10:30:00Z"
  }
}
```

## üö® Notas Importantes

### ‚ö†Ô∏è Colecci√≥n Postman Pendiente de Actualizaci√≥n
**Endpoints disponibles en la colecci√≥n actual:**
- ‚úÖ Autenticaci√≥n (5 endpoints)
- ‚úÖ Listas de Compra (5 endpoints)  
- ‚úÖ Productos (5 endpoints)
- ‚úÖ Categor√≠as (4 endpoints)
- ‚úÖ Tiendas (5 endpoints)
- ‚úÖ Invitaciones (5 endpoints)
- ‚úÖ Dashboard de Monitoreo (4 endpoints)
- ‚úÖ Desarrollo (3 endpoints)
- ‚úÖ **Inteligencia Artificial (7 endpoints)** - Fases 9, 15, 17 ‚úÖ Implementados (CU-28, CU-29, CU-32)
- ‚úÖ **Blueprints/Plantillas (6 endpoints)** - Fase 10 ‚úÖ Implementados
- ‚úÖ **Administraci√≥n (4 endpoints)** - Fase 11 ‚úÖ Implementados
- ‚úÖ **Seguridad y Cache (5 endpoints)** - Fase 12 ‚úÖ Implementados

**Total: 48 endpoints completamente documentados** ‚úÖ

> **‚úÖ Actualizado**: Todos los endpoints de IA (incluye **Categorizaci√≥n Masiva CU-29**, **Listas Inteligentes por Ocasi√≥n CU-32**), Blueprints, Admin y Seguridad est√°n completamente implementados, funcionando y **documentados en esta colecci√≥n**. Tambi√©n disponibles en Swagger UI: `/api/docs`

### Autenticaci√≥n
- Todos los endpoints (excepto registro, login y acceso a invitaciones) requieren token JWT
- El token se incluye autom√°ticamente si usas la variable `{{token}}`
- Expira en 1 hora por defecto

### Estados HTTP
- **200**: OK - Operaci√≥n exitosa
- **201**: Created - Recurso creado
- **400**: Bad Request - Error de validaci√≥n
- **401**: Unauthorized - Token inv√°lido/faltante
- **403**: Forbidden - Sin permisos
- **404**: Not Found - Recurso no encontrado
- **409**: Conflict - Recurso duplicado
- **500**: Internal Server Error

### Variables de Entorno
```json
{
  "baseUrl": "http://localhost:3000/api/v1",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userId": "user-uuid-here",
  "listId": "list-uuid-here",
  "productId": "product-uuid-here",
  "categoryId": "category-uuid-here",
  "storeId": "store-uuid-here",
  "invitationHash": "secure-hash-here"
}
```

#### Paso 5: Inteligencia Artificial (ü§ñ IA)
```
11. AI ‚Üí Sugerencias de Categor√≠as (nombre producto)
11. AI ‚Üí üÜï Categorizaci√≥n Masiva (hasta 50 productos)
11. AI ‚Üí Health Check IA
11. AI ‚Üí Informaci√≥n de Uso (solo admin)
11. AI ‚Üí Obtener Ocasiones Disponibles (20+ ocasiones)
11. AI ‚Üí Generar Lista por Ocasi√≥n (barbacoa, cena rom√°ntica, etc.)
11. AI ‚Üí Preview Lista por Ocasi√≥n (sin guardar en DB)
```

#### Paso 6: Blueprints/Plantillas (üìã Templates)
```
12. Blueprints ‚Üí Crear Blueprint (desde lista existente)
12. Blueprints ‚Üí Obtener Mis Blueprints
12. Blueprints ‚Üí Obtener Blueprints P√∫blicos
12. Blueprints ‚Üí Crear Lista desde Blueprint
12. Blueprints ‚Üí Actualizar/Eliminar Blueprint
```

#### Paso 7: Funcionalidades Administrativas (‚ö†Ô∏è Solo Admins)
```
13. Admin ‚Üí Impersonar Usuario
13. Admin ‚Üí Consultar Auditor√≠a (filtros: fecha, usuario)
13. Admin ‚Üí Finalizar Impersonaci√≥n
13. Admin ‚Üí Health Check Admin
```

### Probar Permisos
1. Crea lista con Usuario A
2. Comparte con Usuario B (solo lectura)
3. Intenta modificar con Usuario B ‚Üí Debe fallar
4. Cambia permisos a lectura-escritura
5. Intenta modificar con Usuario B ‚Üí Debe funcionar

### Probar Listas Inteligentes por Ocasi√≥n (üéâ NUEVO - CU-32)
```json
// 1. Ver ocasiones disponibles
GET /occasion-lists/occasions
// Respuesta: 20 ocasiones predefinidas

// 2. Generar lista para barbacoa (8 personas, 150‚Ç¨)
POST /occasion-lists/generate
{
  "occasion": "Barbacoa",
  "numberOfPeople": 8,
  "budget": 150,
  "dietaryRestrictions": ["Sin gluten"]
}

// 3. Preview sin guardar
POST /occasion-lists/preview
{
  "occasion": "Cena rom√°ntica",
  "numberOfPeople": 2,
  "budget": 80
}
```

**Ocasiones disponibles:**
- Barbacoa, Cena rom√°ntica, Fiesta infantil
- Desayuno fitness, Cena navide√±a, Picnic
- Brunch dominical, Cena vegana, Noche de pel√≠culas
- Aperitivo con amigos, Comida familiar, Cena de negocios
- Comida saludable semanal, Fiesta de cumplea√±os
- Cena de San Valent√≠n, Halloween, Domingo de f√∫tbol
- Tarde de juegos de mesa, Cena de Acci√≥n de Gracias
- Comida de playa

### Probar Recomendaciones Contextuales (üéØ NUEVO - CU-33)
```bash
# 1. Obtener ejemplos de contexto (p√∫blico, sin auth)
GET /api/v1/recommendations/context-examples
# Respuesta: Ejemplos de contextos √∫tiles y tips

# 2. Recomendaciones generales para una lista
GET /api/v1/recommendations/{listId}?creativityLevel=balanced&maxRecommendations=10
# Headers: Authorization: Bearer {{accessToken}}

# 3. Recomendaciones con contexto espec√≠fico
GET /api/v1/recommendations/{listId}?context=Cena%20italiana&excludeExisting=true
# Headers: Authorization: Bearer {{accessToken}}

# 4. Recomendaciones basadas en producto espec√≠fico
GET /api/v1/recommendations/{listId}/for-product/{productId}
# Headers: Authorization: Bearer {{accessToken}}

# 5. Filtrar por categor√≠a y tienda
GET /api/v1/recommendations/{listId}?categoryId={catId}&storeId={storeId}
# Headers: Authorization: Bearer {{accessToken}}
```

**Par√°metros opcionales:**
- `maxRecommendations` (5-50, default: 10) - Cantidad de sugerencias
- `creativityLevel` (conservative/balanced/creative) - Nivel de innovaci√≥n
- `categoryId` - Filtrar por categor√≠a espec√≠fica
- `storeId` - Filtrar por productos de tienda
- `context` - Contexto textual ("Cena rom√°ntica", "Desayuno fitness")
- `includeUserHistory` (boolean) - Incluir historial de compras
- `excludeExisting` (boolean, default: true) - Excluir productos ya en lista

**Niveles de creatividad:**
- **Conservative**: Solo productos muy relacionados, alta confiabilidad
- **Balanced**: Mix equilibrado (recomendado), buena relaci√≥n creatividad/confianza
- **Creative**: Sugerencias innovadoras, mayor exploraci√≥n

**Tipos de recomendaci√≥n en respuesta:**
- `complement` - Producto complementario directo
- `frequently_together` - Productos comprados juntos frecuentemente
- `category_match` - Productos de la misma categor√≠a/contexto
- `user_preference` - Basado en historial del usuario

**Ejemplo de respuesta:**
```json
{
  "success": true,
  "data": {
    "listId": "abc123",
    "recommendations": [
      {
        "name": "Salsa de tomate",
        "reason": "Complementa perfectamente con la pasta que agregaste",
        "confidenceScore": 92,
        "suggestedCategory": {"id": "cat456", "name": "Salsas"},
        "estimatedPrice": 2.5,
        "suggestedQuantity": 1,
        "suggestedUnit": "unidades",
        "relatedProducts": ["Pasta"],
        "tags": ["italiano", "b√°sico"],
        "recommendationType": "complement"
      }
    ],
    "detectedContext": "Comida italiana casual",
    "productsInList": 5,
    "metadata": {
      "processingTime": 1250,
      "aiUsed": true,
      "averageConfidence": 87.3
    }
  }
}
```


```
13. Admin ‚Üí Impersonar Usuario
13. Admin ‚Üí Consultar Auditor√≠a (filtros: fecha, usuario)
13. Admin ‚Üí Finalizar Impersonaci√≥n
13. Admin ‚Üí Health Check Admin
```

## üîç Troubleshooting

### Error 401 - Unauthorized
- Verifica que el token est√© configurado en `{{token}}`
- Ejecuta Login de nuevo para obtener token fresco
- Revisa que el header Authorization est√© presente

### Error 403 - Forbidden (Admin Endpoints)
- Confirma que el usuario tenga rol ADMIN
- Verifica que el middleware de roles est√© funcionando
- Revisa los logs del servidor para debugging

### Error 429 - Too Many Requests (Rate Limiting)
- **Admin General**: Espera 15 minutos (m√°x 10 requests)
- **Admin Impersonaci√≥n**: Espera 1 hora (m√°x 5 requests)
- **Admin Auditor√≠a**: Espera 5 minutos (m√°x 20 requests)
- Verifica headers X-RateLimit-* para detalles

### Error 404 - Not Found
- Verifica que las variables (listId, productId, etc.) est√©n configuradas
- Confirma que el recurso existe ejecutando el GET correspondiente

### Error 500 - Internal Server Error
- Revisa los logs del servidor en la terminal
- Verifica que la base de datos est√© corriendo
- Confirma que RabbitMQ est√© disponible

### Variables No Se Guardan
- Verifica que est√©s usando el entorno correcto
- Revisa la pesta√±a "Tests" de los requests para ver los scripts
- Confirma que la respuesta sea exitosa (200/201)

---

## üÜï Nuevo: Categorizaci√≥n Masiva con IA (CU-29)

### üì¶ Descripci√≥n
Endpoint que permite categorizar hasta **50 productos simult√°neamente** usando IA (Perplexity Llama 3.1 Sonar), optimizando costos mediante batching inteligente y cache Redis.

### üéØ Endpoint
```
POST /api/v1/ai/bulk-categorize
```

### üìù Request Body Ejemplo
```json
{
  "products": [
    {
      "nombre": "Leche entera Pascual 1L",
      "descripcion": "Leche pasteurizada botella 1 litro"
    },
    {
      "nombre": "Pan integral"
    },
    {
      "nombre": "Coca Cola 2L"
    },
    {
      "nombre": "Pechuga de pollo",
      "descripcion": "Pollo fresco de granja"
    },
    {
      "nombre": "Tomates cherry"
    }
  ],
  "tiendaId": "{{storeId}}",
  "enrichWithExistingCategories": true
}
```

### ‚úÖ Respuesta Exitosa (200 OK)
```json
{
  "success": true,
  "data": {
    "categorizedProducts": [
      {
        "nombre": "Leche entera Pascual 1L",
        "suggestedCategory": {
          "nombre": "L√°cteos",
          "tiendaId": "uuid-tienda",
          "confidence": 95
        },
        "alternativeCategories": [
          { "nombre": "Bebidas", "confidence": 60 }
        ],
        "source": "ai",
        "processingTimeMs": 1250
      }
    ],
    "batchStats": {
      "totalProducts": 5,
      "successful": 5,
      "failed": 0,
      "fromCache": 2,
      "fromAI": 3,
      "fromExisting": 0,
      "averageConfidence": 88.5,
      "totalProcessingTimeMs": 3200,
      "estimatedTokens": 450
    }
  }
}
```

### üîë Caracter√≠sticas Clave
- **üì¶ Batching Inteligente**: Divisi√≥n autom√°tica en sub-lotes de 20 productos
- **üíæ Cache Redis**: TTL 24h para reducir costos de API
- **üìä Enriquecimiento BD**: Usa categor√≠as existentes de la tienda
- **üõ°Ô∏è Validaci√≥n 3 Niveles**: DTO Zod + Use Case + Service Layer
- **üìà Estad√≠sticas Completas**: Confidence, sources, timing detallados
- **‚ö†Ô∏è Fallos Parciales**: C√≥digo 207 si algunos productos fallan
- **üîê Rate Limiting**: 5 requests/hora por usuario

### üéØ Casos de Uso
1. **Onboarding de usuarios**: Categorizar productos masivamente al crear cuenta
2. **Importaci√≥n de listas**: Categorizar productos importados de otras apps
3. **Optimizaci√≥n de BD**: Re-categorizar productos existentes con baja confianza
4. **Testing IA**: Validar calidad de categorizaci√≥n en lote

### ‚ö†Ô∏è Validaciones
- **M√≠nimo**: 1 producto
- **M√°ximo**: 50 productos por batch
- **Nombre producto**: 1-100 caracteres (requerido)
- **Descripci√≥n**: 0-500 caracteres (opcional)
- **tiendaId**: UUID v√°lido (opcional)

### üìä C√≥digos de Respuesta
- `200 OK`: Todos categorizados exitosamente
- `207 Multi-Status`: Algunos productos fallaron (ver `batchStats.failed`)
- `400 Bad Request`: Validaci√≥n fallida (>50 productos, nombres inv√°lidos)
- `401 Unauthorized`: Token JWT faltante o inv√°lido
- `429 Too Many Requests`: Rate limit excedido (5 req/hora)
- `500 Internal Server Error`: Error del servidor

### üí° Tips de Uso
- Usa `tiendaId` para mejor precisi√≥n con categor√≠as existentes
- Activa `enrichWithExistingCategories: true` para priorizar categor√≠as de BD
- Monitorea `batchStats.averageConfidence` (ideal >85%)
- Cache Redis evita llamadas duplicadas (ahorro de costos)
- Revisa `warnings` en respuesta para optimizaciones

---

## üõ°Ô∏è 11. Admin & Security

### Security Test - Vulnerability Scan

**Endpoint**: `GET /admin/security/test`
**Autenticaci√≥n**: Bearer Token (Rol Admin requerido)

### üîç Descripci√≥n
Ejecuta una suite completa de tests de seguridad autom√°ticos para validar la postura de seguridad de la aplicaci√≥n.

### üìä Response Format
```json
{
  "success": true,
  "securityScore": 95,
  "totalTests": 24,
  "passedTests": 23,
  "failedTests": 1,
  "summary": {
    "critical": 0,
    "high": 1,
    "medium": 0,
    "low": 23
  },
  "report": "üîê === SECURITY SCAN REPORT ===\nüìä Overall Security Score: 95/100\n‚úÖ GOOD: Security posture is good with minor improvements needed.",
  "results": [
    {
      "testName": "HTTPS Enforcement",
      "passed": false,
      "details": "HTTPS not enforced (development environment)",
      "severity": "MEDIUM",
      "recommendation": "Enable HTTPS for production deployment"
    }
  ],
  "timestamp": "2025-10-30T23:45:00.000Z"
}
```

### üß™ Tests Incluidos
1. **XSS Protection** (6 vectores): Script injection, JavaScript URLs, event handlers
2. **SQL Injection Protection** (7 vectores): Union attacks, DROP commands, OR conditions
3. **Rate Limiting**: Validaci√≥n de configuraci√≥n Redis
4. **Security Headers**: X-Frame-Options, HSTS, CSP, X-XSS-Protection
5. **HTTPS Configuration**: SSL enforcement, certificados
6. **Authentication Security**: JWT tokens, password hashing
7. **Database Security**: SSL connections, credential exposure

### üéØ Interpretaci√≥n del Score
- **90-100**: üèÜ EXCELLENT - Listo para producci√≥n
- **80-89**: ‚úÖ GOOD - Mejoras menores necesarias
- **70-79**: ‚ö†Ô∏è MODERATE - Mejoras requeridas antes de producci√≥n
- **<70**: üö® POOR - Issues cr√≠ticos de seguridad

### üîë Caracter√≠sticas Clave
- **‚ö° Ejecuci√≥n R√°pida**: ~2-3 segundos para suite completa
- **üìä Scoring Inteligente**: Algoritmo weighted por severidad
- **üéØ Solo Fallos**: Response muestra solo tests que fallaron
- **üìã Recomendaciones**: Acciones espec√≠ficas para cada fallo
- **üîê Admin Only**: Requiere rol de administrador

### ‚ö†Ô∏è Validaciones
- **Autenticaci√≥n**: JWT Bearer token v√°lido
- **Autorizaci√≥n**: Rol 'admin' requerido
- **Rate Limiting**: Aplicado por `adminRateLimitMiddleware`

### üìä C√≥digos de Respuesta
- `200 OK`: Tests ejecutados exitosamente (independiente del score)
- `401 Unauthorized`: Token JWT faltante o inv√°lido
- `403 Forbidden`: Usuario sin rol de administrador
- `429 Too Many Requests`: Rate limit administrativo excedido
- `500 Internal Server Error`: Error en la ejecuci√≥n de tests

### üí° Tips de Uso
- Ejecuta antes de deployments a producci√≥n
- Monitorea el score regularmente (objetivo >90%)
- Usa las recomendaciones para priorizar mejoras de seguridad
- Los tests en desarrollo pueden fallar por configuraciones locales
- Revisa el `report` completo para contexto detallado

---

## ü§ù Contribuci√≥n

Si encuentras alg√∫n endpoint que falta o alg√∫n error en la colecci√≥n:

1. Reporta el issue en GitHub
2. Env√≠a PR con las correcciones
3. Actualiza esta documentaci√≥n

---

**¬°Happy Testing! üéâ**

√öltima actualizaci√≥n: 30 de octubre de 2025 - CU-27 Security Production-Ready Completado